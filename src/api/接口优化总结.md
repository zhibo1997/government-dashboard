# API 接口优化总结

## ✅ 已完成的优化

### 1. 核心架构重构

#### 创建的文件
- ✅ `src/api/apiConfig.ts` - 业务模块参数配置管理
- ✅ `src/api/apiFactory.ts` - 泛型 API 工厂函数（支持任意 swagger 模块）
- ✅ `src/api/index.ts` - 统一导出入口（已重构）
- ✅ `src/services/commonService.ts` - 通用服务层（登录、数据字典）
- ✅ `src/services/waterSupplyService.ts` - 供水模块服务层

#### 生成的 API 模块
- ✅ `src/api/common.ts` - 通用模块（登录、字典）- swagger 自动生成
- ✅ `src/api/waterSupplyAndDrainage.ts` - 供水排水模块 - swagger 自动生成

### 2. 已迁移的组件

#### OverviewModule.vue
**变更前**:
```typescript
import api from '@/api/openApi'
const res = await api.overviewData.List()
```

**变更后**:
```typescript
import { getWaterOverview } from '@/services/waterSupplyService'
const data = await getWaterOverview()
```

#### LoginView.vue
**变更前**:
```typescript
import { loginService } from '@/services/loginService'
const result = await loginService.login(formData.value)
```

**变更后**:
```typescript
import { login } from '@/services/commonService'
const result = await login(formData.value.username, formData.value.password)
```

### 3. 优化亮点

1. **保留 swagger 类封装** ✅
   - HttpClient 保留不动
   - 所有生成的代码保持原样
   - 通过工厂函数统一配置

2. **泛型工厂模式** ✅
   ```typescript
   export function createApiClient<TClient extends ApiClientBase>(
     ApiCtor: ApiConstructor<TClient>,
     options: ApiClientOptions = {}
   ): TClient
   ```
   - 支持任意 swagger 生成的 Api 类
   - 统一拦截器配置
   - 灵活的参数注入

3. **服务层函数封装** ✅
   - 组件中使用更简洁
   - 直接返回数据，无需解析 response
   - 便于测试和维护

4. **文档精简** ✅
   - 只保留 README.md（使用指南）
   - 删除了 5 个冗余的 MD 文档
   - 简洁明了

## 🚀 使用方式

### 方式 1：服务层函数（推荐）

```typescript
import { login } from '@/services/commonService'
import { getWaterOverview } from '@/services/waterSupplyService'

// 登录
const data = await login('username', 'password')

// 获取供水总览
const overview = await getWaterOverview()
```

### 方式 2：API 客户端

```typescript
import { createWaterSupplyApi, createCommonApi } from '@/api'

const waterApi = createWaterSupplyApi()
const commonApi = createCommonApi()

// 调用接口
const res = await waterApi.overviewData.List()
const publicKey = await commonApi.login.publicKeyList()
```

## 📦 添加新模块示例

### 燃气模块

```bash
# 1. 生成 API 客户端
npx swagger-typescript-api \
  -p "http://your-api/swagger.json" \
  -o ./src/api/ \
  -n gas \
  --axios
```

```typescript
// 2. 在 apiFactory.ts 中添加
import { Api as GasApi } from './gas'

export function createGasApi(): GasApi<unknown> {
  return createApiClient(GasApi, { module: BusinessModule.GAS })
}
```

```typescript
// 3. 创建服务层（可选）
// src/services/gasService.ts
import { createGasApi } from '@/api/apiFactory'

const gasApi = createGasApi()

export async function getGasOverview() {
  const res = await gasApi.overview.List()
  return res.data
}
```

## 🎯 核心优势

1. **低成本** - 保留 swagger 生成代码，无需手动维护
2. **易扩展** - 泛型工厂支持任意新模块
3. **易使用** - 服务层函数简化调用
4. **类型安全** - 完整的 TypeScript 支持
5. **向后兼容** - 旧代码仍可运行

## 📚 相关文档

- [API 使用指南](./README.md)
- [代码示例](./apiFactory.ts)
- [配置说明](./apiConfig.ts)

---

**优化完成时间**: 2025-10-25  
**技术栈**: Vue 3 + TypeScript + Axios + Swagger TypeScript API  
**状态**: ✅ 优化完成，已迁移 2 个组件
